# Misc 10 @jdonszelmann

```rust
{{#include ../../code/examples/misc_10.rs}}
```


<details>
<summary>Solution</summary>

```
{{#include ../../code/examples/stderr/misc_10.stderr}}
```

Despite the closure being `move`, not the whole `ThreadSafePtr` is moved into the `async` block. Rust allows us to move different fields of a struct into different closures or async blocks. Since we only access `y.0`, it only moves *that* field, which is a `*const T`, which is not `Send`, which means this code doesn't compile.

A slightly comical way to fix it is like this:

```rust

use std::future::Future;

struct ThreadSafePtr<T>(pub *const T);
unsafe impl<T> Send for ThreadSafePtr<T> {}

fn requires_send(f: impl Future + Send) {}

fn main() {
    let x = 10;
    let y = ThreadSafePtr(&raw const x);

    requires_send(async move {
        let y = y; // <-- ADD THIS
        println!("{}", unsafe{*y.0})
    })
}
```

</details>

Note, before edition 2021, this kind of splitting was not possible and `y` *would* be moved into the closure as a whole.
